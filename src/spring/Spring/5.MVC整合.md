# SpringMVC

springmvc是spring的一个模块，专门做web开发。

springmvc容器中是放的控制器对象，我们通常用@Controller注解创建对象放到容器。

web开发的底层是servlet，springmvc中有一个对象是DispatchServlet（中央调度器），它负责接收用户的所有请求，用户把请求给了DispatchServlet，之后DispatchServlet把请求转发给我们的Controller对象。

![image-20200902200845834](https://tva1.sinaimg.cn/large/007S8ZIlly1gickbz6ffjj30wm0ksqaj.jpg)

前端控制器：DispatcherServlet

## SpringMVC快速入门

1.新建maven web工程

![image-20200903122313258](https://tva1.sinaimg.cn/large/007S8ZIlly1gidchto7fzj31cy0ioq96.jpg)

2.导入mvc依赖

```xml
<dependencies>
  <dependency>
    <groupId>junit</groupId>
    <artifactId>junit</artifactId>
    <version>4.11</version>
    <scope>test</scope>
  </dependency>
  <dependency>
    <groupId>javax.servlet</groupId>
    <artifactId>javax.servlet-api</artifactId>
    <version>3.1.0</version>
  </dependency>
  <dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-webmvc</artifactId>
    <version>5.2.5.RELEASE</version>
  </dependency>
  <dependency>
    <groupId>org.projectlombok</groupId>
    <artifactId>lombok</artifactId>
    <version>1.18.12</version>
  </dependency>
  <dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-databind</artifactId>
    <version>2.11.0</version>
  </dependency>
</dependencies>
```

3.在Webapp->WEB-INF->web.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0">

    <!--声明，注册springmvc的核心对象DispatcherServlet
    需要再tomcat启动后，创建DispatcherServlet实例，
    因为创建DispatcherServlet实例的时候，会同时创建springmvc容器对象，
    读取spring的配置文件，把这个配置文件中的对象都创建好，当用户发起请求时就可以直接使用对象。
    springmvc创建容器对象是，默认读取的配置文件是/WEB-INF/<servlet-name>-servlet.xml
    -->
    <servlet>
        <servlet-name>springmvc</servlet-name>
        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
        <!--自定义springmvc读取的配置文件的位置-->
        <init-param>
            <param-name>contextConfigLocation</param-name>
            <param-value>classpath:springmvc.xml</param-value>
        </init-param>
        <!--在tomcat启动后，创建Servlet对象-->
        <load-on-startup>1</load-on-startup>
    </servlet>
    <servlet-mapping>
        <!--满足url后缀是do条件的url交给springmvc这个DispatcherServlet解决-->
        <servlet-name>springmvc</servlet-name>
        <url-pattern>*.do</url-pattern>
    </servlet-mapping>
</web-app>
```

4.在resource目录下新建springmvc.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       https://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd">

    <context:component-scan base-package="com.zstu.controller" />

    <mvc:annotation-driven />
</beans>
```

4.新建com.zstu.controller包，包下新建MyController类

```java
package com.zstu.controller;

import com.zstu.dto.UserDTO;
import com.zstu.pojo.Student;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.servlet.ModelAndView;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@Controller
@RequestMapping("/test")
public class MyController {

    @RequestMapping(value = "/example1.do", method = RequestMethod.GET)
    public ModelAndView doGet(HttpServletRequest request, HttpServletResponse response){
        String name = request.getParameter("name");
        ModelAndView modelAndView = new ModelAndView();
        modelAndView.addObject("msg", "第一个spring项目:" + name);
        modelAndView.setViewName("/show.jsp");
        return modelAndView;
    }

    @RequestMapping(value = "/example2.do", method = RequestMethod.POST)
    public ModelAndView doPost1(@RequestParam(value = "name") String xname){
        ModelAndView modelAndView = new ModelAndView();
        modelAndView.addObject("msg", "第一个spring项目:" + xname);
        modelAndView.setViewName("/show.jsp");
        return modelAndView;
    }

    @RequestMapping(value = "/example3.do", method = RequestMethod.GET)
    public String doGet2(){
        //绝对路径
        return "/hello.jsp";
    }

    @RequestMapping(value = "/example4.do", method = RequestMethod.POST)
    @ResponseBody
    public Student doPost2(UserDTO dto){
        System.out.println(dto);
        Student student = new Student();
        student.setName("ls");
        student.setAge(12);
        return student;
    }
}
```

c

* 从HttpServletRequest对象中获取
* 使用自定义的DTO获取
* 利用@RequestParam注解可以变更参数名称

请求返回值类型：

* ModelAndView：一般结合jsp使用，将数据返回给jsp渲染

* String：跳转指定的jsp

* Object：可以是List，Map，Bean对象，最终返回到调用方的是json数据（记得要添加jackson依赖）

注：Python requests包中的data={"name":123}和json={"name":123}的区别？

data={}传的application/x-www-form-urlencoded

json={}传的application/json



![image-20200902233400466](https://tva1.sinaimg.cn/large/007S8ZIlly1gicq9g5kxtj30yd082n4e.jpg)



ModelAandView

String

void（了解）注：Python requests包中的data={"name":123}和json={"name":123}的区别？

data={}传的application/x-www-form-urlencoded

json={}传的application/json